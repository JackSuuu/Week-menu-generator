<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luly çš„å¯çˆ±ä¾¿å½“å‘¨è®¡åˆ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans SC', 'sans-serif'],
                        display: ['ZCOOL KuaiLe', 'cursive'],
                        hand: ['Ma Shan Zheng', 'cursive'],
                    },
                    colors: {
                        'luly-red': '#ff6b6b',
                        'luly-yellow': '#ffe66d',
                        'luly-blue': '#4ecdc4',
                        'luly-dark': '#292f36',
                        'luly-bg': '#f7fff7',
                        'paper': '#fffbf0',
                    },
                    animation: {
                        'bounce-slow': 'bounce 3s infinite',
                        'wiggle': 'wiggle 1s ease-in-out infinite',
                    },
                    keyframes: {
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-3deg)' },
                            '50%': { transform: 'rotate(3deg)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f7fff7;
            background-image: 
                radial-gradient(#4ecdc4 15%, transparent 16%),
                radial-gradient(#ff6b6b 15%, transparent 16%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            overflow-x: hidden;
        }

        /* æ‰‹è´¦é£æ ¼çš„ä¸è§„åˆ™é˜´å½± */
        .doodle-shadow {
            box-shadow: 6px 6px 0px 2px #292f36;
            border: 3px solid #292f36;
        }
        .doodle-shadow:hover {
            box-shadow: 8px 8px 0px 4px #292f36;
            transform: translate(-2px, -2px) rotate(-1deg);
        }
        .doodle-shadow:active {
            box-shadow: 0px 0px 0px 2px #292f36;
            transform: translate(4px, 4px);
        }

        /* åƒä¾¿åˆ©è´´ä¸€æ ·çš„éšæœºè¾¹æ¡† */
        .sticky-note {
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
        }

        /* æ¨¡æ€æ¡†åŠ¨ç”» */
        dialog[open] {
            animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        dialog::backdrop {
            background: rgba(41, 47, 54, 0.4);
            backdrop-filter: blur(4px);
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.9) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* å¯çˆ±æ»šåŠ¨æ¡ */
        .cute-scroll::-webkit-scrollbar {
            width: 10px;
        }
        .cute-scroll::-webkit-scrollbar-track {
            background: #fff;
            border-radius: 5px;
            border: 2px solid #292f36;
        }
        .cute-scroll::-webkit-scrollbar-thumb {
            background: #ff6b6b;
            border-radius: 5px;
            border: 2px solid #292f36;
        }

        /* æ—‹è½¬å·¥å…·ç±» */
        .rotate-r-2 { transform: rotate(2deg); }
        .rotate-l-2 { transform: rotate(-2deg); }
        .rotate-r-1 { transform: rotate(1deg); }
        .rotate-l-1 { transform: rotate(-1deg); }
    </style>
</head>
<body class="min-h-screen text-luly-dark p-4 md:p-8">

    <!-- è£…é¥°è´´çº¸ -->
    <div class="fixed top-10 left-10 text-6xl animate-bounce-slow hidden xl:block pointer-events-none">ğŸ¥¦</div>
    <div class="fixed bottom-20 right-10 text-6xl animate-bounce-slow hidden xl:block pointer-events-none" style="animation-delay: 1s">ğŸ—</div>
    <div class="fixed top-40 right-20 text-6xl animate-bounce-slow hidden xl:block pointer-events-none" style="animation-delay: 0.5s">ğŸ…</div>

    <!-- Header -->
    <header class="max-w-4xl mx-auto text-center mb-10 pt-4 relative">
        <div class="inline-block bg-white p-6 sticky-note doodle-shadow rotate-l-2">
            <h1 class="font-display text-5xl md:text-6xl text-luly-red mb-2 tracking-wide">
                ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ
                <span class="inline-block text-4xl animate-wiggle">ğŸ¤”</span>
            </h1>
            <p class="text-xl font-hand text-luly-dark font-bold">Luly çš„ä¸“å±éšæœºèœå• Â· V2.0 åŠ å¼ºç‰ˆ</p>
        </div>
    </header>

    <!-- Controls -->
    <div class="max-w-5xl mx-auto mb-10 flex flex-wrap justify-center gap-4 md:gap-8 z-10 relative">
        <button onclick="generateWeek()" class="doodle-shadow px-6 py-3 bg-luly-yellow text-luly-dark font-display text-xl rounded-xl hover:bg-yellow-300 transition-colors rotate-l-1">
            ğŸ² å˜é­”æœ¯ç”Ÿæˆèœå•
        </button>

        <button onclick="copyMarkdown()" class="doodle-shadow px-6 py-3 bg-luly-blue text-white font-display text-xl rounded-xl hover:bg-teal-400 transition-colors rotate-r-1">
            ğŸ“‹ å¤åˆ¶ Markdown
        </button>
        
        <button onclick="openManager()" class="doodle-shadow px-6 py-3 bg-white text-luly-dark font-display text-xl rounded-xl hover:bg-gray-50 transition-colors rotate-l-1">
            âœï¸ ç¼–è¾‘æˆ‘çš„èœå•åº“
        </button>
    </div>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Visual Menu (Left 2 Columns) -->
        <div id="visual-menu" class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6 pb-20">
            <!-- Cards will be injected here -->
            <div class="col-span-1 md:col-span-2 text-center py-20">
                <div class="inline-block p-8 bg-white sticky-note doodle-shadow rotate-1">
                    <p class="text-2xl font-hand text-gray-400">ç‚¹å‡»ä¸Šé¢çš„â€œå˜é­”æœ¯â€æŒ‰é’®å¼€å§‹å§ï¼âœ¨</p>
                </div>
            </div>
        </div>

        <!-- Markdown Output (Right Column) -->
        <div class="lg:col-span-1">
            <div class="bg-white doodle-shadow p-1 sticky top-8 rotate-1" style="border-radius: 10px;">
                <div class="bg-luly-red text-white p-3 font-display text-xl text-center border-b-4 border-luly-dark">
                    ğŸ“ ç¬”è®°é¢„è§ˆåŒº
                </div>
                <div class="p-2 bg-paper">
                    <textarea id="markdown-output" class="w-full h-[500px] p-4 font-mono text-sm bg-transparent border-none resize-none focus:outline-none cute-scroll" readonly placeholder="è¿™é‡Œä¼šç”Ÿæˆ Markdown ä»£ç å“¦..."></textarea>
                </div>
            </div>
        </div>
    </main>

    <!-- Menu Manager Modal -->
    <dialog id="manager-modal" class="bg-transparent p-0 w-full max-w-4xl h-[85vh] backdrop:bg-gray-800/50">
        <div class="w-full h-full bg-paper border-4 border-luly-dark rounded-3xl overflow-hidden flex flex-col shadow-2xl relative">
            
            <!-- Modal Header -->
            <div class="bg-luly-yellow border-b-4 border-luly-dark p-4 flex justify-between items-center">
                <h2 class="font-display text-3xl text-luly-dark">ğŸ¥• èœè°±å¤§ç®¡å®¶</h2>
                <button onclick="closeManager()" class="w-10 h-10 bg-luly-red text-white rounded-full border-2 border-black hover:scale-110 transition-transform font-bold">X</button>
            </div>

            <!-- Modal Body -->
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar (Categories) -->
                <div class="w-1/4 bg-white border-r-4 border-luly-dark overflow-y-auto cute-scroll p-2 flex flex-col gap-2" id="category-tabs">
                    <!-- Tabs injected by JS -->
                </div>

                <!-- Content Area -->
                <div class="w-3/4 flex flex-col bg-paper">
                    <!-- List of items -->
                    <div class="flex-1 overflow-y-auto cute-scroll p-6" id="items-list">
                        <!-- Items injected by JS -->
                    </div>

                    <!-- Add New Item Form -->
                    <div class="border-t-4 border-dashed border-luly-dark p-6 bg-white">
                        <h3 class="font-display text-xl mb-4 text-luly-blue">âœ¨ æ·»åŠ æ–°èœå“åˆ°å½“å‰åˆ†ç±»</h3>
                        <div class="flex gap-4 items-end">
                            <div class="flex-1">
                                <label class="block font-bold text-xs mb-1">èœå</label>
                                <input type="text" id="new-name" class="w-full border-2 border-luly-dark rounded-lg p-2 focus:ring-2 focus:ring-luly-yellow outline-none" placeholder="æ¯”å¦‚ï¼šçº¢çƒ§ç‹®å­å¤´">
                            </div>
                            <div class="flex-1">
                                <label class="block font-bold text-xs mb-1">ğŸ¥© è‚‰ç±»é£Ÿæ</label>
                                <input type="text" id="new-meat" class="w-full border-2 border-luly-dark rounded-lg p-2 focus:ring-2 focus:ring-luly-yellow outline-none" placeholder="çŒªè‚‰ã€é¸¡è›‹...">
                            </div>
                            <div class="flex-1">
                                <label class="block font-bold text-xs mb-1">ğŸ¥¬ è”¬èœé£Ÿæ</label>
                                <input type="text" id="new-veg" class="w-full border-2 border-luly-dark rounded-lg p-2 focus:ring-2 focus:ring-luly-yellow outline-none" placeholder="ç™½èœã€è‘±...">
                            </div>
                            <button onclick="addItem()" class="bg-luly-green bg-[#4ecdc4] text-white border-2 border-luly-dark rounded-lg px-6 py-2 font-display hover:translate-y-[-2px] hover:shadow-lg transition-all">
                                æ·»åŠ 
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </dialog>

    <footer class="text-center mt-10 text-gray-500 font-hand text-lg pb-8">
        <p>Made with ğŸ° for Luly's Kitchen</p>
        <button onclick="resetData()" class="text-xs underline mt-2 text-gray-400 hover:text-red-500">é‡ç½®æ‰€æœ‰æ•°æ®åˆ°åˆå§‹çŠ¶æ€</button>
    </footer>

    <script>
        // --- Category Mapping for UI Names ---
        const categoryMap = {
            cold: "ğŸ¥— å‡‰èœ",
            pressure: "ğŸ¥˜ é«˜å‹é”…/ç”µé¥­ç…²",
            hard: "ğŸ² ç¡¬èœ (å‘¨æœ«)",
            meat: "ğŸ¥© è‚‰èœ",
            veg: "ğŸ¥¬ ç´ èœ",
            steamed: "ğŸ¥£ è’¸èœ",
            riceNoodle: "ğŸœ é¥­/é¢",
            oven: "ğŸ”¥ çƒ¤ç®±"
        };

        // --- Initial Data (Fallback) ---
        const defaultMenuData = {
            cold: [
                {name: "è‘±æ²¹æ‰‹æ’•é¸¡", ingredients: "é¸¡è…¿/æ•´é¸¡ | è‘±ã€å§œ"},
                {name: "é¦™èœæ‹Œç‰›è‚‰", ingredients: "ç‰›è‚‰ | é¦™èœ"},
                {name: "å‡‰æ‹Œé»„ç“œ", ingredients: " | é»„ç“œã€å¤§è’œã€å°ç±³è¾£"},
                {name: "ç³–æ¸ç•ªèŒ„", ingredients: " | ç•ªèŒ„ã€ç³–"},
                {name: "é…¸è¾£æŸ æª¬è™¾", ingredients: "è™¾ | æŸ æª¬ã€è¾£æ¤’"},
                {name: "æ³°å¼æŸ æª¬è™¾", ingredients: "è™¾ | æ³°å¼è°ƒæ–™"},
            ],
            pressure: [
                {name: "éå¸¸ç«¥å¹´å¤é¸¡è…¿", ingredients: "é¸¡è…¿ã€é¸¡è›‹ | è‘±ã€å§œã€è’œ"},
                {name: "ç•ªèŒ„ç‰›è…©", ingredients: "ç‰›è…© | ç•ªèŒ„ã€æ´‹è‘±ã€åœŸè±†ã€å§œã€ç•ªèŒ„é…±"},
                {name: "åœŸè±†ç‰›è…©", ingredients: "ç‰›è…© | åœŸè±†ã€èƒ¡èåœã€å§œ"},
                {name: "ç…²ä»”é¥­", ingredients: "å¹¿å¼è…Šè‚ ã€é¸¡è›‹ | èœå¿ƒã€å§œã€èšæ²¹"},
                {name: "éŸ©å¼æ‹Œé¥­", ingredients: "ç‰›è‚‰ä¸/äº”èŠ±è‚‰ã€é¸¡è›‹ | è±†èŠ½ã€è èœã€èƒ¡èåœã€é¦™è‡"},
            ],
            hard: [
                {name: "ç«é”…", ingredients: "ç‰›ç¾Šè‚‰å·ã€å„ç§ä¸¸å­ | è±†è…ã€è”¬èœã€ç«é”…åº•æ–™"},
                {name: "å¯¿å–œé”…", ingredients: "ç‰›è‚‰ç‰‡ã€æ— èŒè›‹ | å†…è„‚è±†è…ã€é¦™è‡ã€é‡‘é’ˆè‡ã€å¤§ç™½èœ"},
                {name: "æ¤°å­é¸¡", ingredients: "æ•´é¸¡ | æ¤°å­æ°´ã€å§œã€æ²™å§œã€é’æŸ "},
                {name: "æ—¥å¼å’–å–±", ingredients: "é¸¡è‚‰/ç‰›è‚‰ | åœŸè±†ã€èƒ¡èåœã€æ´‹è‘±ã€å’–å–±å—ã€æ¤°æµ†"},
            ],
            meat: [
                {name: "é»‘æ¤’æµ·ç›æ°å…‹ç‰›æ’", ingredients: "ç‰›æ’ã€é»„æ²¹ | é»‘èƒ¡æ¤’ã€æµ·ç›ã€å¤§è’œã€è¿·è¿­é¦™"},
                {name: "è’œé¦™é»‘æ¤’ç‰›æŸ³", ingredients: "ç‰›é‡Œè„Š | å¤§è’œã€é»‘èƒ¡æ¤’ã€èšæ²¹ã€æ·€ç²‰"},
                {name: "èœæ¤’è¥¿å…°èŠ±è¥¿è‘«èŠ¦ç‚’ç‰›æŸ³", ingredients: "ç‰›é‡Œè„Š | å½©æ¤’ã€è¥¿å…°èŠ±ã€è¥¿è‘«èŠ¦ã€å¤§è’œ"},
                {name: "è¶…çº§lulyé»„ç„–é¸¡", ingredients: "é¸¡è…¿è‚‰ | å¹²é¦™è‡ã€åœŸè±†ã€é’æ¤’ã€å§œã€é»„è±†é…±"},
                {name: "å¹²ç…æŸ æª¬é¸¡", ingredients: "é¸¡è…¿è‚‰ | æŸ æª¬ã€èœ‚èœœã€é»‘èƒ¡æ¤’ã€å¤§è’œ"},
                {name: "å°é¸¡ç‚–åœŸè±†åŠ è˜‘è‡", ingredients: "é¸¡è‚‰ | è˜‘è‡ã€åœŸè±†ã€ç²‰æ¡ã€å§œ"},
                {name: "è‘±æ²¹ç„–é¸¡", ingredients: "é¸¡è…¿è‚‰ | çº¢è‘±å¤´/å¤§è‘±"},
                {name: "å½©æ¤’ç‚’é¸¡è…¿è‚‰", ingredients: "é¸¡è…¿è‚‰ | å½©æ¤’"},
                {name: "å¯ä¹é¸¡ç¿…", ingredients: "é¸¡ç¿… | å¯ä¹"},
                {name: "ç³–é†‹æ’éª¨", ingredients: "çŒªæ’éª¨ | å§œã€èŠéº»ã€é¦™é†‹"},
                {name: "æ— æ•Œç”œæ¤’è¾£ç‚’è‚‰", ingredients: "çŒªè‚‰ | ç”œæ¤’ã€å°–æ¤’ã€å¤§è’œ"},
                {name: "å†œå®¶ä¸€ç¢—é¦™", ingredients: "äº”èŠ±è‚‰ã€é¸¡è›‹ | é’æ¤’ã€å¤§è’œã€è±†è±‰"},
                {name: "å›é”…è‚‰", ingredients: "äº”èŠ±è‚‰ | é’è’œã€è±†ç“£é…±"},
                {name: "å¹´ç³•æ±¤ï¼ˆé±¼ä¸¸ï¼‰", ingredients: "é±¼ä¸¸ | å¹´ç³•ã€è™¾çš®ã€ç´«èœã€è‘±ã€ç™½èƒ¡æ¤’ç²‰"},
                {name: "è’œè“‰é»„æ²¹è™¾", ingredients: "è™¾ã€é»„æ²¹ | è’œè“‰"},
                {name: "é¦™ç…é¾™åˆ©é±¼", ingredients: "é¾™åˆ©é±¼ | é»‘èƒ¡æ¤’"},
            ],
            veg: [
                {name: "èšæ²¹ç”Ÿèœ", ingredients: " | ç”Ÿèœã€å¤§è’œã€èšæ²¹ã€æ·€ç²‰"},
                {name: "æ¸…ç‚’ç™½èœ", ingredients: " | å¤§ç™½èœã€å¤§è’œ"},
                {name: "æ¸…ç‚’è¥¿å…°èŠ±", ingredients: " | è¥¿å…°èŠ±ã€å¤§è’œ"},
                {name: "è’œé¦™èŠ¦ç¬‹", ingredients: " | èŠ¦ç¬‹ã€å¤§è’œ"},
                {name: "é†‹æºœç™½èœ", ingredients: " | å¤§ç™½èœã€å¹²è¾£æ¤’ã€å¤§è’œ"},
                {name: "æ‰‹æ’•åŒ…èœ", ingredients: "äº”èŠ±è‚‰ç‰‡ | å·å¿ƒèœã€å¹²è¾£æ¤’ã€å¤§è’œã€è’¸é±¼è±‰æ²¹"},
                {name: "è’œé¦™ç…è±†è…", ingredients: " | è±†è…ã€è’œ"},
                {name: "lulyæœ€çˆ±ç•ªèŒ„ç‚’è›‹", ingredients: "é¸¡è›‹ | ç•ªèŒ„ã€å°è‘±ã€ç•ªèŒ„é…±"},
                {name: "é»„ç“œç‚’è›‹", ingredients: "é¸¡è›‹ | é»„ç“œã€å¤§è’œ"},
                {name: "è¥¿è‘«èŠ¦ç‚’è›‹", ingredients: "é¸¡è›‹ | è¥¿è‘«èŠ¦ã€å¤§è’œ"},
                {name: "çº¢çƒ§åœŸè±†ç‰‡", ingredients: " | åœŸè±†ã€é…±æ²¹"},
                {name: "åœ°ä¸‰é²œ", ingredients: " | èŒ„å­ã€åœŸè±†ã€é’æ¤’ã€å¤§è’œã€æ·€ç²‰"},
                {name: "åœŸè±†çƒ©èŒ„å­", ingredients: " | åœŸè±†ã€èŒ„å­ã€å¤§è’œã€é»„è±†é…±"},
                {name: "è‚‰æœ«èŒ„å­", ingredients: "çŒªè‚‰æœ« | èŒ„å­ã€å§œã€è’œã€è±†ç“£é…±"},
                {name: "è±†è§’çƒ§è‚‰", ingredients: "äº”èŠ±è‚‰ | è±†è§’"},
                {name: "ç•ªèŒ„é¸¡è›‹æ±¤", ingredients: "é¸¡è›‹ | ç•ªèŒ„ã€è‘±ã€é¦™æ²¹"},
                {name: "ç•ªèŒ„ç™½èœæ±¤", ingredients: " | ç•ªèŒ„ã€å¤§ç™½èœã€å§œ"},
                {name: "è±†è…è˜‘è‡æ±¤", ingredients: " | å«©è±†è…ã€æ‚è‡ã€è‘±ã€ç™½èƒ¡æ¤’ç²‰"},
                {name: "ç‰ç±³æ’éª¨æ±¤", ingredients: "æ’éª¨ | ç‰ç±³"},
            ],
            steamed: [
                {name: "è’¸é¸¡è›‹", ingredients: "é¸¡è›‹ | é¦™æ²¹ã€è‘±èŠ±"},
                {name: "å—ç“œè’¸ç‰›è‚‰", ingredients: "ç‰›è‚‰ç‰‡ | å—ç“œã€å§œä¸ã€è’œæœ«"},
                {name: "é¦™è‡æ»‘é¸¡", ingredients: "é¸¡è…¿è‚‰ | å¹²é¦™è‡ã€çº¢æ£ã€å§œã€æ·€ç²‰"},
            ],
            riceNoodle: [
                {name: "å‡‰æ‹Œé¸¡ä¸", ingredients: "é¸¡èƒ¸è‚‰ | è°ƒæ–™"},
                {name: "æµ·å—é¸¡é¥­", ingredients: "é¸¡è‚‰ | å¤§ç±³ã€æ–‘æ–“å¶ã€é¦™èŒ…ã€å§œã€è¾£æ¤’é…±"},
                {name: "å¤è‚‰é¥­", ingredients: "äº”èŠ±è‚‰ã€é¸¡è›‹ | çº¢è‘±å¤´é…¥ã€å¹²é¦™è‡ã€äº”é¦™ç²‰"},
                {name: "æ‰“æŠ›é¥­", ingredients: "çŒªè‚‰æœ«ã€é¸¡è›‹ | ç½—å‹’å¶ã€å°ç±³è¾£ã€å¤§è’œã€é±¼éœ²"},
                {name: "æ—¥å¼ç¢é¸¡é¥­", ingredients: "é¸¡è‚‰æœ«ã€é¸¡è›‹ | å››å­£è±†/è·å…°è±†ã€å‘³é†‚"},
                {name: "æ—¥å¼ä¸‰æ–‡é±¼ç›–é¥­", ingredients: "ä¸‰æ–‡é±¼ | ç±³é¥­"},
                {name: "è‘±æ²¹é¸¡è…¿é¥­", ingredients: "é¸¡è…¿ | è‘±æ²¹é…±æ±ã€é’èœ"},
                {name: "ç…§çƒ§é¸¡è…¿é¥­", ingredients: "é¸¡è…¿ | ç…§çƒ§æ±"},
                {name: "ç•ªèŒ„æ»‘è›‹ç‰›è‚‰é¥­", ingredients: "ç‰›è‚‰ç‰‡ã€é¸¡è›‹ | ç•ªèŒ„"},
                {name: "ç•ªèŒ„è‚‰é…±æ„é¢", ingredients: "çŒª/ç‰›è‚‰æœ« | æ„é¢ã€ç•ªèŒ„ã€æ´‹è‘±ã€å¤§è’œ"},
                {name: "å¥¶æ²¹é¸¡è‚‰æ„é¢", ingredients: "é¸¡è…¿è‚‰ | æ„é¢ã€æ·¡å¥¶æ²¹ã€å£è˜‘ã€è èœ"},
                {name: "åƒå±‚é¢", ingredients: "è‚‰é…±ã€èŠå£« | é¢çš®"},
                {name: "é…¸æ±¤æ°´é¥º", ingredients: "æ°´é¥º | é™ˆé†‹ã€è¾£æ¤’æ²¹ã€ç´«èœã€è™¾çš®ã€é¦™èœ"},
                {name: "éº»è¾£çƒ«", ingredients: "å„ç±»ä¸¸å­ | è”¬èœ"},
                {name: "é˜³æ˜¥é¢", ingredients: "çŒªæ²¹ | é¢æ¡ã€è‘±"},
            ],
            oven: [
                {name: "çƒ¤èŒ„å­", ingredients: " | èŒ„å­ã€è’œã€å‰æ¤’ã€è‘±èŠ±ã€å­œç„¶ç²‰"},
                {name: "çƒ¤å…¨é¸¡", ingredients: "æ•´é¸¡ã€é»„æ²¹ | é»‘èƒ¡æ¤’ã€æŸ æª¬ã€è¿·è¿­é¦™"},
                {name: "åŒ—äº¬çƒ¤é¸­", ingredients: "é¸­å­ | èœ‚èœœã€è·å¶é¥¼ã€è‘±ä¸ã€é»„ç“œæ¡ã€ç”œé¢é…±"},
            ]
        };

        // --- Application State ---
        let menuData = {};
        let currentTab = 'meat';

        // --- Data Management Functions ---
        function initData() {
            const stored = localStorage.getItem('lulyMenuData_v2');
            if (stored) {
                menuData = JSON.parse(stored);
            } else {
                menuData = JSON.parse(JSON.stringify(defaultMenuData)); // Deep copy
            }
        }

        function saveData() {
            localStorage.setItem('lulyMenuData_v2', JSON.stringify(menuData));
        }

        function resetData() {
            if(confirm('ç¡®å®šè¦é‡ç½®å›é»˜è®¤èœå•å—ï¼Ÿä½ æ·»åŠ çš„èœå“éƒ½ä¼šæ¶ˆå¤±å“¦ï¼')) {
                localStorage.removeItem('lulyMenuData_v2');
                location.reload();
            }
        }

        // --- Generator Logic (Enhanced) ---
        const weekDays = ["å‘¨å…­", "å‘¨æ—¥", "å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”"];
        
        // Track used dishes across the week to prevent duplicates
        let usedDishes = new Set();
        
        function getRandom(arr, excludeSet = null) {
            if (!arr || arr.length === 0) return { name: "æš‚æ— èœå“", ingredients: "" };
            
            // Create a copy of the array
            const availableItems = arr.filter(item => !excludeSet || !excludeSet.has(item.name));
            
            if (availableItems.length === 0) {
                // If all items are used, reset and start over
                return arr[Math.floor(Math.random() * arr.length)];
            }
            
            return availableItems[Math.floor(Math.random() * availableItems.length)];
        }
        
        // Fisher-Yates shuffle for better randomization
        function shuffleArray(arr) {
            const shuffled = [...arr];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Parse ingredients string into meat and veg parts
        function parseIngredients(ingredientsStr) {
            if (!ingredientsStr) return { meat: '', veg: '' };
            const parts = ingredientsStr.split('|');
            return {
                meat: (parts[0] || '').trim() || 'æ— ',
                veg: (parts[1] || '').trim() || 'æ— '
            };
        }

        function getDailyMenu(dayIndex) {
            const isWeekend = (dayIndex === 0 || dayIndex === 1);
            let dishes = [];
            let comboType = "";
            const roll = Math.random();

            // Safety check for empty categories
            const safeGet = (pool) => {
                if (!pool || pool.length === 0) return null;
                const dish = getRandom(pool, usedDishes);
                if (dish && dish.name !== "æš‚æ— èœå“") {
                    usedDishes.add(dish.name);
                }
                return dish;
            }

            if (isWeekend) {
                if (roll < 0.4) {
                    const pool = [...(menuData.hard||[]), ...(menuData.oven||[]), ...(menuData.pressure||[])];
                    const dish = safeGet(pool);
                    if(dish) dishes.push(dish);
                    comboType = "weekend-special";
                } else if (roll < 0.8) {
                    const meat = safeGet(menuData.meat);
                    const veg = safeGet(menuData.veg);
                    if(meat) dishes.push(meat);
                    if(veg) dishes.push(veg);
                    comboType = "standard";
                } else {
                    const rice = safeGet(menuData.riceNoodle);
                    if(rice) dishes.push(rice);
                    comboType = "one-dish";
                }
            } else {
                if (roll < 0.5) {
                    const meat = safeGet(menuData.meat);
                    const veg = safeGet(menuData.veg);
                    if(meat) dishes.push(meat);
                    if(veg) dishes.push(veg);
                    comboType = "standard";
                } else if (roll < 0.8) {
                    const rice = safeGet(menuData.riceNoodle);
                    if(rice) dishes.push(rice);
                    comboType = "one-dish";
                } else {
                    const meat = safeGet([...(menuData.meat||[]), ...(menuData.steamed||[])]);
                    if(meat) dishes.push(meat);
                    if (Math.random() > 0.6) {
                        const side = safeGet([...(menuData.veg||[]), ...(menuData.cold||[])]);
                        if(side) dishes.push(side);
                    }
                    comboType = "simple";
                }
            }
            return { dishes, comboType };
        }

        function generateWeek() {
            const container = document.getElementById('visual-menu');
            const mdOutput = document.getElementById('markdown-output');
            
            // Reset used dishes to prevent duplicates across the whole week
            usedDishes = new Set();
            
            container.innerHTML = '';
            let markdownContent = "| æœ¬å‘¨èœå• | åœ¨å®¶äººæ•° | èœå• | è‚‰ç±» | è”¬èœ |\n| :--- | :---: | :--- | :--- | :--- |\n";

            weekDays.forEach((day, index) => {
                const { dishes, comboType } = getDailyMenu(index);
                
                // Styling
                let typeClass = "bg-white rotate-r-1";
                let icon = "ğŸ³";
                let borderColor = "border-luly-dark";
                
                // Random rotations for scrapbook feel
                const rotations = ["rotate-1", "-rotate-1", "rotate-2", "-rotate-2", "rotate-0"];
                const randRot = rotations[Math.floor(Math.random() * rotations.length)];

                if (comboType === 'weekend-special') {
                    typeClass = "bg-[#ffe66d] " + randRot; // Yellow
                    icon = "ğŸ²";
                } else if (comboType === 'one-dish') {
                    typeClass = "bg-[#fffbf0] " + randRot; // Paper color
                    icon = "ğŸœ";
                } else {
                    typeClass = "bg-white " + randRot;
                }

                const dishesHtml = dishes.map(d => {
                    const ing = parseIngredients(d.ingredients);
                    return `
                    <div class="mb-3 last:mb-0 group/dish relative">
                        <div class="absolute -left-2 top-2 w-full h-2 bg-luly-yellow opacity-30 transform -skew-x-12 hidden group-hover/dish:block transition-all"></div>
                        <span class="relative font-bold text-lg text-luly-dark z-10 cursor-help">${d.name}</span>
                        <p class="text-xs text-gray-600 mt-1 font-hand">ğŸ¥© ${ing.meat}</p>
                        <p class="text-xs text-green-600 mt-0.5 font-hand">ğŸ¥¬ ${ing.veg}</p>
                    </div>
                    `;
                }).join('');

                const people = (index === 0 || index === 1) ? "â­â˜€" : (Math.random() > 0.3 ? "â­â˜€" : "â­");

                const card = document.createElement('div');
                card.className = `relative p-5 sticky-note doodle-shadow flex flex-col justify-between h-full min-h-[180px] ${typeClass} overflow-hidden transition-all duration-300`;
                card.innerHTML = `
                    <div class="absolute -top-4 -right-4 p-4 opacity-10 text-8xl select-none font-display pointer-events-none text-black">${icon}</div>
                    <div class="mb-4 flex justify-between items-center border-b-2 border-dashed border-gray-300 pb-2">
                        <h3 class="font-display text-2xl text-luly-red">${day}</h3>
                        <span class="text-xs font-bold bg-luly-dark text-white px-2 py-1 rounded-full">${people}</span>
                    </div>
                    <div class="relative z-10 flex-1 flex flex-col justify-center">
                        ${dishesHtml || '<span class="text-gray-400 italic">ç‚¹å¤–å–å§?</span>'}
                    </div>
                `;
                
                container.appendChild(card);

                const dishesText = dishes.map(d => d.name).join(" + ");
                const meatText = dishes.map(d => parseIngredients(d.ingredients).meat).join(" / ");
                const vegText = dishes.map(d => parseIngredients(d.ingredients).veg).join(" / ");
                markdownContent += `| ${day} | ${people} | ${dishesText} | ${meatText} | ${vegText} |\n`;
            });

            mdOutput.value = markdownContent;

            // Simple Stagger Animation
            Array.from(container.children).forEach((child, i) => {
                child.style.opacity = '0';
                child.style.transform = 'translateY(20px) rotate(0deg)';
                setTimeout(() => {
                    child.style.transition = 'all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    child.style.opacity = '1';
                    // Apply random rotation back
                    const rot = Math.random() * 4 - 2; 
                    child.style.transform = `translateY(0) rotate(${rot}deg)`;
                }, i * 100);
            });
        }

        // --- Manager UI Logic ---
        function openManager() {
            renderManagerTabs();
            renderManagerItems();
            document.getElementById('manager-modal').showModal();
        }

        function closeManager() {
            document.getElementById('manager-modal').close();
            // Refresh main view to reflect changes if any
            generateWeek();
        }

        function renderManagerTabs() {
            const tabsContainer = document.getElementById('category-tabs');
            tabsContainer.innerHTML = '';
            
            Object.keys(categoryMap).forEach(key => {
                const btn = document.createElement('button');
                const isActive = currentTab === key;
                btn.className = `w-full text-left p-3 rounded-lg font-display text-lg mb-2 transition-all ${isActive ? 'bg-luly-yellow border-2 border-luly-dark shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] translate-x-1' : 'hover:bg-gray-100'}`;
                btn.innerText = categoryMap[key];
                btn.onclick = () => {
                    currentTab = key;
                    renderManagerTabs();
                    renderManagerItems();
                };
                tabsContainer.appendChild(btn);
            });
        }

        function renderManagerItems() {
            const listContainer = document.getElementById('items-list');
            listContainer.innerHTML = '';
            
            const items = menuData[currentTab] || [];

            if (items.length === 0) {
                listContainer.innerHTML = `<div class="text-center text-gray-400 font-hand text-xl mt-10">è¿™ä¸ªåˆ†ç±»è¿˜æ²¡æœ‰èœå“¦ï¼Œå¿«å»æ·»åŠ å§ï¼ğŸ˜‹</div>`;
                return;
            }

            items.forEach((item, index) => {
                const ing = parseIngredients(item.ingredients);
                const row = document.createElement('div');
                row.className = "flex justify-between items-center bg-white p-3 mb-2 rounded-lg border border-gray-200 hover:border-luly-blue hover:shadow-md transition-all group";
                row.innerHTML = `
                    <div>
                        <div class="font-bold text-lg">${item.name}</div>
                        <div class="text-xs text-gray-600 mt-1">ğŸ¥© ${ing.meat}</div>
                        <div class="text-xs text-green-600">ğŸ¥¬ ${ing.veg}</div>
                    </div>
                    <button onclick="deleteItem(${index})" class="text-gray-300 hover:text-red-500 font-bold px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                `;
                listContainer.appendChild(row);
            });
        }

        function addItem() {
            const nameInput = document.getElementById('new-name');
            const meatInput = document.getElementById('new-meat');
            const vegInput = document.getElementById('new-veg');
            
            const name = nameInput.value.trim();
            const meat = meatInput.value.trim();
            const veg = vegInput.value.trim();
            const ingredients = `${meat} | ${veg}`;

            if (!name) {
                alert("èœåä¸èƒ½ä¸ºç©ºå“¦ï¼ğŸ˜¤");
                return;
            }

            if (!menuData[currentTab]) menuData[currentTab] = [];
            
            menuData[currentTab].push({ name, ingredients });
            saveData();
            
            // Clear inputs
            nameInput.value = '';
            meatInput.value = '';
            vegInput.value = '';
            
            // Refresh list
            renderManagerItems();
            
            // Cute success feedback
            const btn = document.querySelector('button[onclick="addItem()"]');
            const originalText = btn.innerText;
            btn.innerText = "æ·»åŠ æˆåŠŸ! ğŸ‰";
            setTimeout(() => btn.innerText = originalText, 1500);
        }

        function deleteItem(index) {
            if(confirm('ç¡®å®šè¦ç‹ å¿ƒåˆ æ‰è¿™é“èœå—ï¼ŸğŸ¥º')) {
                menuData[currentTab].splice(index, 1);
                saveData();
                renderManagerItems();
            }
        }

        function copyMarkdown() {
            const copyText = document.getElementById("markdown-output");
            if (!copyText.value) {
                alert("å…ˆç”Ÿæˆèœå•å†å¤åˆ¶å‘€ï¼ğŸ¤ª");
                return;
            }
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(copyText.value).then(() => {
                const btn = document.querySelector('button[onclick="copyMarkdown()"]');
                const originalText = btn.innerHTML;
                btn.innerHTML = "âœ… å¤åˆ¶å¥½å•¦ï¼";
                btn.classList.add("bg-green-600");
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove("bg-green-600");
                }, 2000);
            });
        }

        // --- Initialization ---
        window.onload = function() {
            initData();
            generateWeek();
        };

    </script>
</body>
</html>
